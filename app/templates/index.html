<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>check</title>

    <!-- Load mock before Telegram script for local development -->
    {% if config.TELEGRAM_MOCK %}
    <script src="{{ url_for('static', filename='scripts/telegram-mock.js') }}"></script>
    {% endif %}
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&text=square&display=block">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/index.css') }}">
</head>
<body>
    <div class="projects">
        {% for item in projects %}
            {% set project = item.project %}
            {% set staleness = item.staleness_ratio %}
            {# Start fading earlier at 0.3 (30% of periodicity), reach minimum at 2.0+ #}
            {% if staleness < 0.3 %}
                {% set opacity = 1.0 %}
                {% set bg_lightness = 0 %}
            {% else %}
                {# Fade from 1.0 to 0.5 opacity as staleness goes from 0.3 to 2.0 #}
                {% set fade_factor = ((staleness - 0.3) / 1.7)|float %}
                {% set fade_factor = [fade_factor, 1.0]|min %}
                {% set opacity = 1.0 - (fade_factor * 0.5) %}
                {# Lighten background from #000 to #555 #}
                {% set bg_lightness = (fade_factor * 85)|int %}
            {% endif %}
            <div class="project" 
                 data-id="{{ project.id }}" 
                 onclick="location.href='/project/{{ project.id }}'"
                 style="opacity: {{ '%.2f'|format(opacity) }}; background-color: hsl(0, 0%, {{ bg_lightness }}%);">
                <h2>{{ project.name }}</h2>
                <p class="description">{{ project.description }}</p>
            </div>
        {% endfor %}

        <div class="project new-project">
            <a href="/project/new">+ Новый проект</a>
        </div>

        <script src="{{ url_for('static', filename='scripts/telegram-init.js') }}"></script>
        <script src="{{ url_for('static', filename='scripts/todo.js') }}"></script>
    </div>
</body>
</html>