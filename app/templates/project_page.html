<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>check — {{ project.name }}</title>

    <!-- Load mock before Telegram script for local development -->
    {% if config.TELEGRAM_MOCK %}
    <script src="{{ url_for('static', filename='scripts/telegram-mock.js') }}"></script>
    {% endif %}
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&text=edit_square,square&display=block">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/project_page.css') }}">
</head>

<body>
    <div class="content">
        <div class="info">
            <div class="title">
                <h1>{{ project.name }} <span class="id-block">#{{ project.id }}</span></h1>
                <a href="{{ url_for('main.edit_project', project_id=project.id) }}" class="btn-edit"><span
                        class="material-symbols-sharp notranslate no-select">
                        edit_square
                    </span></a>
            </div>
            <p class="description">{{ project.description }}</p>

        </div>

        <div class="tasks-timeline">
            {% for task in sorted_tasks %}
            <div class="task-row" {% if task.status.value !='done' %}draggable="true" {% endif %}
                data-task-id="{{ task.id }}">
                <div class="timeline {% if task.status.value != 'done' %}draggable-handle{% endif %}">
                    <div class="timeline-line"></div>
                    <div class="timeline-dot {% if task.status.value == 'done' %}completed{% endif %}"></div>
                    {% if task.status.value == 'done' and task.completed_at %}
                    <div class="timeline-time" data-time="{{ task.completed_at|utc_iso }}"></div>
                    {% endif %}
                </div>
                <div class="task status-{{ task.status.value }}" id="task-{{ task.id }}" data-task-id="{{ task.id }}"
                    data-completed-at="{{ task.completed_at|utc_iso }}">
                    <p>{{ task.title }}</p>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="new-task-form">
            <input type="text" id="newTaskInput" placeholder="Новая задача" maxlength="128">
        </div>
    </div>

    <!-- Modal for editing/deleting task -->
    <div id="taskModal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <h3>Редактировать задачу</h3>
            <input type="text" id="editTaskInput" placeholder="Название задачи" maxlength="128">
            <div class="modal-actions">
                <button id="saveTaskBtn" class="btn-primary">Сохранить</button>
                <button id="deleteTaskBtn" class="btn-danger">Удалить</button>
                <button id="cancelTaskBtn" class="btn-secondary">Отмена</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='scripts/telegram-init.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/project_page.js') }}"></script>
</body>

</html>